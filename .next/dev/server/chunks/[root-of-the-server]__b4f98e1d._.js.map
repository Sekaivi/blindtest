{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/roxis/Documents/Travail/MMI/S5/blindtest/src/app/api/api.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst api = axios.create({\r\n    baseURL: 'https://api.deezer.com',\r\n    timeout: 10000,\r\n    headers: {\r\n        'Content-Type': 'application/json',\r\n    }\r\n});\r\n\r\napi.interceptors.response.use(\r\n    (response) => response,\r\n    (error) => {\r\n        console.error('Erreur API => ', error);\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\nexport default api;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,kJAAK,CAAC,MAAM,CAAC;IACrB,SAAS;IACT,SAAS;IACT,SAAS;QACL,gBAAgB;IACpB;AACJ;AAEA,IAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CACzB,CAAC,WAAa,UACd,CAAC;IACG,QAAQ,KAAK,CAAC,kBAAkB;IAChC,OAAO,QAAQ,MAAM,CAAC;AAC1B;uCAGW"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/roxis/Documents/Travail/MMI/S5/blindtest/src/app/api/tracks/route.js"],"sourcesContent":["export const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport api from \"@/app/api/api\"; // ton axios\r\n\r\n// Mélange Fisher–Yates\r\nfunction shuffle(array) {\r\n    for (let i = array.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [array[i], array[j]] = [array[j], array[i]];\r\n    }\r\n    return array;\r\n}\r\n\r\n// Filtrage min/max et dédoublonnage\r\nfunction filterAndClean(tracks, minRank, maxRank) {\r\n    const seen = new Set();\r\n    const result = [];\r\n    for (const t of tracks) {\r\n        if (\r\n            t?.id &&\r\n            !seen.has(t.id) &&\r\n            Number(t.rank) >= minRank &&\r\n            Number(t.rank) <= maxRank\r\n        ) {\r\n            seen.add(t.id);\r\n            result.push(t);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nexport async function GET(request) {\r\n    const { searchParams } = new URL(request.url);\r\n\r\n    const mode = searchParams.get(\"mode\") ?? \"search\"; // search | genre | playlist\r\n    const query = searchParams.get(\"q\") ?? \"\"; // mot-clé pour search ou playlist\r\n    const genreIdsParam = searchParams.get(\"q\"); // ex: \"129,152\"\r\n    // Genres -> 0: All, 132: Pop, 116: Rap/Hip Hop, 152: Rock, 165: R&B, 85: Alternative, 106: Electro, 466: Folk,\r\n    // 144: Reggae, 129: Jazz, 84: Country, 52: French Chanson, 98: Classical, 173: Film/Games, 464: Metal,\r\n    // 169: Soul & Funk, 2: African Music, 12: Arabic Music, 16: Asian Music, 153: Blues, 75: Brazilian Music,\r\n    // 81: Indian Music, 95: Kids, 197: Latin Music\r\n    const minRank = Number(searchParams.get(\"minRank\") ?? 0);\r\n    const maxRank = Number(searchParams.get(\"maxRank\") ?? 1000000);\r\n    const limit = Number(searchParams.get(\"limit\") ?? 10);\r\n    const artistsLimit = Number(searchParams.get(\"artistsLimit\") ?? 200);\r\n    const tracksPerArtist = Number(searchParams.get(\"tracksPerArtist\") ?? 40);\r\n\r\n    try {\r\n        let tracks = [];\r\n\r\n        if (mode === \"search\") {\r\n            // recherche par mot-clé\r\n            const res = await api.get(\"/search\", { params: { q: query, limit: 50 } });\r\n            tracks = res.data?.data ?? [];\r\n        }\r\n\r\n        else if (mode === \"genre\") {\r\n            if (!genreIdsParam) {\r\n                return NextResponse.json(\r\n                    { error: \"Paramètre 'q' requis pour le mode genre\" },\r\n                    { status: 400 }\r\n                );\r\n            }\r\n\r\n            const q = genreIdsParam.split(\",\").map((id) => id.trim());\r\n\r\n            for (const genreId of q) {\r\n                // récupérer les artistes du genre\r\n                const artistsRes = await api.get(`/genre/${genreId}/artists`, {\r\n                    params: { limit: artistsLimit },\r\n                });\r\n\r\n                for (const artist of artistsRes.data.data) {\r\n                    const topRes = await api.get(`/artist/${artist.id}/top`, {\r\n                        params: { limit: tracksPerArtist },\r\n                    });\r\n                    tracks.push(...(topRes.data.data ?? []));\r\n                }\r\n            }\r\n        }\r\n\r\n        else if (mode === \"playlist\") {\r\n            const playlistId = searchParams.get(\"q\"); // si on donne un id direct\r\n            let playlist = null;\r\n\r\n            if (!playlistId) {\r\n                return NextResponse.json(\r\n                    { error: `Playlist '${playlistId || query}' introuvable` },\r\n                    { status: 404 }\r\n                );\r\n            } else {\r\n                const plRes = await api.get(`/playlist/${playlistId}`);\r\n                playlist = plRes.data;\r\n            }\r\n\r\n            // récupérer les tracks\r\n            const tracksRes = await api.get(`/playlist/${playlist.id}`, {\r\n                params: { limit: 100 },\r\n            });\r\n            tracks = tracksRes.data?.tracks?.data ?? [];\r\n        }\r\n\r\n        // pipeline commun\r\n        let finalTracks = filterAndClean(tracks, minRank, maxRank);\r\n        finalTracks = shuffle(finalTracks);\r\n\r\n        return NextResponse.json(finalTracks.slice(0, limit));\r\n    } catch (error) {\r\n        console.error(\"Erreur API Deezer:\", error?.response?.data ?? error?.message);\r\n        return NextResponse.json({ error: \"Erreur côté serveur\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}