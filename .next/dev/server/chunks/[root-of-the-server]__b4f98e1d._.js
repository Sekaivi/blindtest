module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/http2 [external] (http2, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/tty [external] (tty, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[project]/src/app/api/api.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$axios$2f$lib$2f$axios$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/axios/lib/axios.js [app-route] (ecmascript)");
;
const api = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$axios$2f$lib$2f$axios$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].create({
    baseURL: 'https://api.deezer.com',
    timeout: 10000,
    headers: {
        'Content-Type': 'application/json'
    }
});
api.interceptors.response.use((response)=>response, (error)=>{
    console.error('Erreur API => ', error);
    return Promise.reject(error);
});
const __TURBOPACK__default__export__ = api;
}),
"[project]/src/app/api/tracks/route.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "runtime",
    ()=>runtime
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$api$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/app/api/api.js [app-route] (ecmascript)"); // ton axios
const runtime = "nodejs";
;
;
// Mélange Fisher–Yates
function shuffle(array) {
    for(let i = array.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [
            array[j],
            array[i]
        ];
    }
    return array;
}
// Filtrage min/max et dédoublonnage
function filterAndClean(tracks, minRank, maxRank) {
    const seen = new Set();
    const result = [];
    for (const t of tracks){
        if (t?.id && !seen.has(t.id) && Number(t.rank) >= minRank && Number(t.rank) <= maxRank) {
            seen.add(t.id);
            result.push(t);
        }
    }
    return result;
}
async function GET(request) {
    const { searchParams } = new URL(request.url);
    const mode = searchParams.get("mode") ?? "search"; // search | genre | playlist
    const query = searchParams.get("q") ?? ""; // mot-clé pour search ou playlist
    const genreIdsParam = searchParams.get("q"); // ex: "129,152"
    // Genres -> 0: All, 132: Pop, 116: Rap/Hip Hop, 152: Rock, 165: R&B, 85: Alternative, 106: Electro, 466: Folk,
    // 144: Reggae, 129: Jazz, 84: Country, 52: French Chanson, 98: Classical, 173: Film/Games, 464: Metal,
    // 169: Soul & Funk, 2: African Music, 12: Arabic Music, 16: Asian Music, 153: Blues, 75: Brazilian Music,
    // 81: Indian Music, 95: Kids, 197: Latin Music
    const minRank = Number(searchParams.get("minRank") ?? 0);
    const maxRank = Number(searchParams.get("maxRank") ?? 1000000);
    const limit = Number(searchParams.get("limit") ?? 10);
    const artistsLimit = Number(searchParams.get("artistsLimit") ?? 200);
    const tracksPerArtist = Number(searchParams.get("tracksPerArtist") ?? 40);
    try {
        let tracks = [];
        if (mode === "search") {
            // recherche par mot-clé
            const res = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$api$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get("/search", {
                params: {
                    q: query,
                    limit: 50
                }
            });
            tracks = res.data?.data ?? [];
        } else if (mode === "genre") {
            if (!genreIdsParam) {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: "Paramètre 'q' requis pour le mode genre"
                }, {
                    status: 400
                });
            }
            const q = genreIdsParam.split(",").map((id)=>id.trim());
            for (const genreId of q){
                // récupérer les artistes du genre
                const artistsRes = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$api$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get(`/genre/${genreId}/artists`, {
                    params: {
                        limit: artistsLimit
                    }
                });
                for (const artist of artistsRes.data.data){
                    const topRes = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$api$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get(`/artist/${artist.id}/top`, {
                        params: {
                            limit: tracksPerArtist
                        }
                    });
                    tracks.push(...topRes.data.data ?? []);
                }
            }
        } else if (mode === "playlist") {
            const playlistId = searchParams.get("q"); // si on donne un id direct
            let playlist = null;
            if (!playlistId) {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: `Playlist '${playlistId || query}' introuvable`
                }, {
                    status: 404
                });
            } else {
                const plRes = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$api$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get(`/playlist/${playlistId}`);
                playlist = plRes.data;
            }
            // récupérer les tracks
            const tracksRes = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$api$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get(`/playlist/${playlist.id}`, {
                params: {
                    limit: 100
                }
            });
            tracks = tracksRes.data?.tracks?.data ?? [];
        }
        // pipeline commun
        let finalTracks = filterAndClean(tracks, minRank, maxRank);
        finalTracks = shuffle(finalTracks);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(finalTracks.slice(0, limit));
    } catch (error) {
        console.error("Erreur API Deezer:", error?.response?.data ?? error?.message);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Erreur côté serveur"
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__b4f98e1d._.js.map